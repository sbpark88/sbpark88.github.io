---
layout: post
title: React - Suspense
subtitle: Suspense vs. Traditional conditional loading
excerpt_image: /assets/images/posts/2024-06-03-suspense/excerpt_image.gif
categories: [javascript, typescript]
tags: [lazy component, use, loading, suspense]
---

### 1. Suspense Component ğŸ‘©â€ğŸ’»

Suspense ëŠ” React ê°€ ì œê³µí•˜ëŠ” Wrapper Component ë¡œ `children`ì˜ ë¡œë”©ì´ ëë‚  ë•Œê¹Œì§€ ë Œë”ë§ í•  ëŒ€ì²´ ì»´í¬ë„ŒíŠ¸ë¥¼ `fallback`ìœ¼ë¡œ 
ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¡œ ê¸°ë³¸ Syntax ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```jsx
<Suspense fallback={<Loading />}>
  <SomeComponent />
</Suspense>
```

React 19 ì—ì„œ ì¶”ê°€ë  ì˜ˆì •ì¸ ê¸°ëŠ¥ë“¤ì´ ìˆê¸° ë•Œë¬¸ì— 19 ë²„ì „ ì •ì‹ ì¶œì‹œ ì´ì „ì—ëŠ” canary ë²„ì „ìœ¼ë¡œ ì„¤ì¹˜í•´ì•¼ ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```shell
# React 19 ë²„ì „ ë¯¸ë§Œì¼ ê²½ìš° canary ë¥¼ ì„¤ì¹˜í•œë‹¤.
npm i react@canary react-dom@canary --legacy-peer-deps
```

---

### 2. Usage ğŸ‘©â€ğŸ’»

#### 1. Displaying a fallback while content is loading

Suspense ê°€ ë“±ì¥í•˜ê¸° ì „ `Albums` ì»´í¬ë„ŒíŠ¸ì˜ ë¡œë”© fallback ì„ ì œê³µí•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.

- Albums.jsx

```jsx
export default function Albums({ artistId }) {
  const [loading, setLoading] = useState(false);
  const [albums, setAlbums] = useState();

  const getAlbums = async () => {
    setLoading(true);
    const response = await fetchData(`/${artistId}/albums`);
    setAlbums(response);
    setLoading(false);
  };

  useEffect(() => {
    getAlbums();
  }, [getAlbums]);

  if (loading) {
    return <Loading />;
  }

  return (
      <ul>
        {albums?.map((album) => (
            <li key={album.id}>
              {album.title} ({album.year})
            </li>
        ))}
      </ul>
  );
}
```

Suspense ë¥¼ ë„ì…í•˜ë©´ ìœ„ ì»´í¬ë„ŒíŠ¸ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ fallback ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

- Albums.jsx

```jsx
export default function Albums({ artistId }) {
  const albums = use(fetchData(`/${artistId}/albums`));
  return (
      <ul>
        {albums.map((album) => (
            <li key={album.id}>
              {album.title} ({album.year})
            </li>
        ))}
      </ul>
  );
}
```

```jsx
<Suspense fallback={<Loading />}>
  <Albums />
</Suspense>
```

`Albums`ê°€ ë¡œë”©ì¤‘ì¼ ë•ŒëŠ” ìë™ìœ¼ë¡œ `Loading`ì´ ë Œë”ë§ ë˜ê³ , ë¡œë”©ì´ ëë‚˜ë©´ `Albums`ë¥¼ ë Œë”ë§ í•´ êµì²´í•œë‹¤. ì´ë¥¼ ì¢€ ë” ì •í™•í•˜ê²Œ 
ì„¤ëª…í•˜ë©´, <span style="color: red;">Suspense ì˜ children ì´ ëª¨ë‘ ë¡œë”©ëœ í›„ fallback ì´ í•´ì œ</span>ëœë‹¤.

ì´ë•Œ Suspense Component ê°€ ë°ì´í„° ë¡œë”©ì„ ê°ì§€í•  ìˆ˜ ìˆëŠ” ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- `Relay`ë‚˜ `Next.js`ì™€ ê°™ì€ Suspense-enabled frameworks ê°€ ë°ì´í„°ë¥¼ fetching í•  ë•Œ.
- `lazy` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ Lazy-loading Component ë¥¼ ì‚¬ìš©í•  ë•Œ.
- `use`ë¡œ wrapping í•œ Promise ë¥¼ ì½ì„ ë•Œ.

ì—¬ê¸°ì„œ `use`ëŠ” React 18 ë²„ì „ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. canary ë²„ì „ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì‹ ê·œ 
<span style="color: red;">**API**</span> ë¡œ React 19 ë²„ì „ì— ì¶”ê°€ë  ì˜ˆì •ì´ë‹¤.

ë”°ë¼ì„œ [Suspense with axios on React 18](#h-3-suspense-with-axios-on-react-18-) ì—ì„œ `use` ì—­í• ì„ í•˜ëŠ” 
Wrapping í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ êµ¬í˜„í•  ê²ƒì´ë‹¤. ë‹¨, `use`ì™€ ë‹¤ë¥¸ ì ì€ **use** ëŠ” Promise ë¿ ì•„ë‹ˆë¼ Context ë¥¼ 
Wrapping í•˜ëŠ” ë°ë„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°˜ë©´ ì•„ë˜ì„œ êµ¬í˜„í•  í•¨ìˆ˜ëŠ” ì˜¤ì§ *Suspense ë¥¼ axios ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ê¸° ìœ„í•œ Wrapping í•¨ìˆ˜* ë‹¤.

ë‹¤ìŒ ì½”ë“œë¥¼ ë³´ì.

```jsx
<Suspense fallback={<Loading />}>
  <Biography />
  <Panel>
    <Albums />
  </Panel>
</Suspense>
```

ì´ë ‡ê²Œ children ì´ ì—¬ëŸ¬ ê°œ ìˆëŠ” ê²½ìš°ëŠ” ì–´ë–»ê²Œ ì‘ë™í• ê¹Œ? <span style="color: red;">Suspense ì˜ children ì´ ëª¨ë‘ ë¡œë”©ëœ í›„ 
fallback ì´ í•´ì œ</span>ëœë‹¤ê³  í–ˆë‹¤. íŠ¹íˆ ìì‹ ì»´í¬ë„ŒíŠ¸ ë¿ ì•„ë‹ˆë¼ ìì† ì»´í¬ë„ŒíŠ¸ê¹Œì§€ ëª¨ë‘ ë‹¤ ë¡œë”©ì´ ì™„ë£Œë˜ì–´ì•¼ fallback ì„ í•´ì œí•  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ì¼ë¶€ ì»´í¬ë„ŒíŠ¸ì˜ ë¡œë”©ì´ ì™„ë£Œ ë˜ë”ë¼ë„ ìì†ì„ í¬í•¨í•œ ëª¨ë“  í•˜ìœ„  ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë”©ë  ë•Œê¹Œì§€ ê³„ì† fallback ìƒíƒœì— ë†“ì—¬ ìˆê²Œ ë˜ê³ , ì‚¬ìš©ìëŠ” 
ì•±ì´ ëŠë¦¬ê²Œ ë°˜ì‘í•´ ì¢‹ì§€ ëª»í•œ ì‚¬ìš©ì ê²½í—˜ì„ í•˜ê²Œ ëœë‹¤.

#### 2. Revealing nested content as it loads

ê·¸ëŸ°ë° ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ëŠ” ëŠë¦¬ê²Œ ë¡œë”©ì´ ë˜ì§€ë§Œ ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ëŠ” ë¹ ë¥´ê²Œ ë¡œë”©ì´ ë  ìˆ˜ë„ ìˆë‹¤. íŠ¹íˆ API ì‘ë‹µì´ ëŠë¦° ë¶€ë¶„ì€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì–´ë–»ê²Œ 
í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë¹ ë¥´ê²Œ ë¡œë”© ëœ ê²ƒë“¤ ë¨¼ì € ë³´ì—¬ì£¼ë©° ë¡œë”©ì´ ì™„ë£Œë¨ì— ë”°ë¼ ì ì§„ì ìœ¼ë¡œ í™”ë©´ì„ ì—…ë°ì´íŠ¸ í•˜ë©´ ë” ì¢‹ì€ ì‚¬ìš©ì ê²½í—˜ì„ 
ì œê³µí•´ ì¤„ ìˆ˜ ìˆë‹¤.

`Error Boundary`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ `Suspense` ì—­ì‹œ ì¤‘ì²©ì´ ê°€ëŠ¥í•˜ë‹¤. ê·¸ë¦¬ê³  ì¤‘ì²©ëœ ê²½ìš° ê°€ì¥ ê°€ê¹Œì´ ìˆëŠ” Suspense ì— ì˜í–¥ì„ ë°›ìœ¼ë¯€ë¡œ 
ëª¨ë“  ìì†ì„ ê°ì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤. ë¬´ìŠ¨ ë§ì¸ì§€ ì½”ë“œë¥¼ ë³´ì.

```jsx
<Suspense fallback={<BigSpinner />}>
  <Biography />
  <Suspense fallback={<AlbumsGlimmer />}>
    <Panel>
      <Albums />
    </Panel>
  </Suspense>
</Suspense>
```

1. `Biography`ê°€ ë¡œë”©ë˜ì§€ ì•Šì•˜ë‹¤ë©´ `BigSpinner`ê°€ fallback ë˜ì–´ ì „ì²´ ì˜ì—­ì„ ëŒ€ì‹ í•œë‹¤.
2. `Biography`ê°€ ë¡œë”©ë˜ë©´ `BigSpinner` fallback ì´ í•´ì œë˜ì–´ content ê°€ ë³´ì—¬ì§„ë‹¤.
3. ë§Œì•½ `Albums`ê°€ ì•„ì§ ë¡œë”©ë˜ì§€ ì•Šì•˜ë‹¤ë©´ `AlbumGlimmer`ê°€ fallback ë˜ì–´ children ì˜ ë¡œë”©ì„ ê¸°ë‹¤ë¦°ë‹¤.
4. `Albums`ê°€ ë¡œë”©ë˜ë©´ `AlbumGlimmer` fallback ì—­ì‹œ í•´ì œë˜ì–´ ëª¨ë“  content ê°€ ë³´ì—¬ì§„ë‹¤.

#### 3. useDeferredValue

ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë™ì•ˆ `Loading` fallback ì´ ëŒ€ì²´í•˜ëŠ” ê²½ìš°ë¥¼ ìƒê°í•´ë³´ì.

```jsx
export default function App() {
  const [query, setQuery] = useState('');
  return (
      <>
        <label>
          Search albums:
          <input value={query} onChange={e => setQuery(e.target.value)} />
        </label>
        <Suspense fallback={<h2>Loading...</h2>}>
          <SearchResults query={query} />
        </Suspense>
      </>
  );
}
```

ì´ ì»´í¬ë„ŒíŠ¸ëŠ” ì´ì „ê³¼ ë‹¬ë¦¬ ë Œë”ë§ì´ ì™„ë£Œëœ ì´í›„ì—ë„ ê³„ì†í•´ì„œ API ìš”ì²­ì„ í•  ìˆ˜ ìˆë‹¤. ì´ ë§ì€ ê²€ìƒ‰ì„ í•  ë•Œë§ˆë‹¤ Promise ë¥¼ ìƒì„±í•˜ê³ , 
ë§¤ë²ˆ fallback ì´ ë Œë”ë§ ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

ì´ë¯¸ ë Œë”ë§ ëœ ì»´í¬ë„ŒíŠ¸ê°€ ë§¤ë²ˆ ì§€ì›Œì§€ê³  ìƒˆë¡­ê²Œ ê·¸ë ¤ì§€ëŠ” ê²ƒì€ ì„±ëŠ¥ì—ë„ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ë§Œ ë¬´ì—‡ë³´ë‹¤ UI ìƒ ì¢‹ì§€ ëª»í•˜ë‹¤ëŠ” ë¬¸ì œì ì„ ê°–ëŠ”ë‹¤. 
ë”°ë¼ì„œ fallback ìœ¼ë¡œ ëŒ€ì²´ë˜ì§€ ì•Šê³ , ìƒˆ ë°ì´í„°ê°€ ë¡œë”©ë˜ì–´ update ë  ë•Œê¹Œì§€ UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œí‚¤ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```jsx
const deferredValue = useDeferredValue(value)
```

[useDeferredValue] ëŠ” UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œí‚¤ëŠ” Hooks ë¡œ 
[debounce](/javascript/ux/ui/2023/07/18/throttle-and-debounce.html#h-3-implementation---debounce-) í•¨ìˆ˜ì™€ 
ë‹¬ë¦¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì§€ì—°ì‹œí‚¤ì§€ ì•Šê³  UI ì—…ë°ì´íŠ¸ë§Œ ì§€ì—°ì‹œí‚¨ë‹¤.

```jsx
export default function App() {
  const [query, setQuery] = useState('');
  const deferredQuery = useDeferredValue(query);
  const isStale = query !== deferredQuery;
  return (
    <>
      <label>
        Search albums:
        <input value={query} onChange={e => setQuery(e.target.value)} />
      </label>
      <Suspense fallback={<h2>Loading...</h2>}>
        <div style={{ opacity: isStale ? 0.5 : 1 }}>
          <SearchResults query={deferredQuery} />
        </div>
      </Suspense>
    </>
  );
}
```

ì´ì œ ë”ì´ìƒ fallback ìœ¼ë¡œ ëŒ€ì²´ë˜ì§€ ì•Šê³  ë¡œë”©ì´ ì™„ë£Œë  ë•Œê¹Œì§€ UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œí‚¨ë‹¤. ë‹¨ ì´ ê²½ìš° ì´ë¯¸ ë¡œë”©ëœ ì»´í¬ë„ŒíŠ¸ì¼ ë•Œë§Œ UI ì—…ë°ì´íŠ¸ë¥¼ 
ì§€ì—°ì‹œí‚¤ëŠ” ê²ƒì´ ì•„ë‹ˆê³  `useDefereedValue`ì— ì˜í•´ ì—…ë°ì´íŠ¸ ë˜ëŠ” ëª¨ë“  UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œí‚¤ê¸° ë•Œë¬¸ì— ìœ„ ì½”ë“œì˜ fallback ì€ í•­ìƒ ëŒ€ì²´ê°€ 
ë˜ì§€ ì•ŠëŠ”ë‹¤. ë§Œì•½ fallback ìœ¼ë¡œ ëŒ€ì²´ê°€ ë˜ë ¤ë©´ `useDefereedValue`ê°€ ì•„ë‹Œ ë‹¤ë¥¸ `state` ì— ì˜í•œ ì—…ë°ì´íŠ¸ê°€ ì´ë£¨ì–´ì ¸ì•¼í•œë‹¤. 

#### 4. startTransition

`useState`ì˜ ì—…ë°ì´íŠ¸ì— ì˜í•œ UI ì—…ë°ì´íŠ¸ ì§€ì—°ì€ `useDeferredValue` í›…ì„ ì‚¬ìš©í•´ í•´ê²°í•  ìˆ˜ ìˆì—ˆë‹¤. ê·¸ëŸ°ë° ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ êµ¬ì¡°ì—ì„œ 
íŠ¹ì • ì»´í¬ë„ŒíŠ¸ë¥¼ ì§€ì—°ì‹œí‚¤ê³ ì í•  ë•ŒëŠ” ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? ì•„ë˜ ì½”ë“œë¥¼ ë³´ì.

```jsx
export default function App() {
  return (
    <Suspense fallback={<BigSpinner />}>
      <Router />
    </Suspense>
  );
}

function Router() {
  const [page, setPage] = useState('/');

  function navigate(url) {
    setPage(url);
  }

  let content;
  if (page === '/') {
    content = (
      <IndexPage navigate={navigate} />
    );
  } else if (page === '/the-beatles') {
    content = (
      <ArtistPage
        artist={{
          id: 'the-beatles',
          name: 'The Beatles',
        }}
      />
    );
  }
  return (
    <Layout>
      {content}
    </Layout>
  );
}

function BigSpinner() {
  return <h2>ğŸŒ€ Loading...</h2>;
}
```

ìœ„ ì½”ë“œë¥¼ ë³´ë©´ ë¼ìš°í„°ë¥¼ Suspense ì»´í¬ë„ŒíŠ¸ê°€ ê°ì‹¸ê³  ìˆê³  fallback ìœ¼ë¡œ `BigSpinner`ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. ê·¸ë¦¬ê³  ë¼ìš°í„°ëŠ” ì–¸ì œë‚˜ 
ë§¤ì¹­ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ `Layout` ì»´í¬ë„ŒíŠ¸ë¡œ ê°ì‹¸ê¸° ë•Œë¬¸ì— ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ ë Œë”ë§ ë˜ë”ë¼ë„ `Layuout`ì€ ë³€í•¨ ì—†ì´ ê³µí†µìœ¼ë¡œ ë Œë”ë§ ë˜ëŠ” 
ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ children ì„ í†µì§¸ë¡œ fallback ìœ¼ë¡œ ëŒ€ì²´í•˜ê¸° ë•Œë¬¸ì— `Router` ì»´í¬ë„ŒíŠ¸ëŠ” í†µì§¸ë¡œ `BigSpinner`ë¡œ ëŒ€ì²´ëœë‹¤. ì§€ì›Œì§ˆ í•„ìš”ê°€ ì—†ëŠ” 
ë ˆì´ì•„ì›ƒê¹Œì§€ ëª¨ë‘ fallback ë˜ì–´ë²„ë¦¬ë‹ˆ ë§ˆì¹˜ SSR ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ì¢‹ì§€ ëª»í•œ ì‚¬ìš©ì ê²½í—˜ì„ í•˜ê²Œ ëœë‹¤.

ì¦‰, í˜„ì¬ ìƒíƒœëŠ” [Revealing nested content as it loads](#h-2-revealing-nested-content-as-it-loads) ì™€ ê°™ë‹¤ê³  
í•  ìˆ˜ ìˆë‹¤.

`Layout`ì€ fallback ì´ ë˜ì§€ ì•Šê³  í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë§Œ fallback ë˜ê²Œ í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ? ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ `Router`ë¥¼ 
`Suspense`ë¡œ ê°ì‹¸ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ¬ë©´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ê°€ ê°–ê³  ìˆëŠ” Suspense ì˜ fallback ë§Œ ì‘ë™í•  ê²ƒì´ë‹¤.

ëŒ€ì‹  ì´ ê²½ìš° `Layout`ì€ fallback ì´ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì²« ë¡œë”©ì‹œì—ë„ fallback ëŒ€ì²´ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ë§Œì•½ ì²« ë¡œë”©ì‹œì—ëŠ” fallback ì„ 
ì‚¬ìš©í•˜ë˜, ì´í›„ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ì—…ë°ì´íŠ¸ ì‹œ ì´ë¯¸ ë Œë”ë§ ëœ content ë¥¼ ìœ ì§€í•œ ì±„ë¡œ í•˜ìœ„ fallback ë§Œ ëŒ€ì²´í•˜ë„ë¡ í•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

> `useDeferredValue`ì™€ `Transitions` ì€ UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œí‚¨ë‹¤.

<br>

ì—¬ê¸°ì„œ ìš°ë¦¬ì—ê²Œ í•„ìš”í•œ ê²ƒì€ `Transition`ì´ë‹¤.

```jsx
startTransition(scope)
```

[startTransition] ì€ <span style="color: red;">UI ë¸”ë¡œí‚¹ ì—†ì´ state ë¥¼ ì—…ë°ì´íŠ¸</span> í•˜ë„ë¡ ë§Œë“œëŠ” 
React <span style="color: red;">**API**</span> ë‹¤. <span style="color: red;">Hooks ê°€ ì•„ë‹ˆë¼ API</span> ì„ì— 
ìœ ì˜í•˜ë„ë¡ í•˜ì.

`useDefferedValue`ëŠ” `state`ë¥¼ parameter ë¡œ ë°›ì•„ ìƒˆ ë³€ìˆ˜ë¥¼ ë°˜í™˜í–ˆë‹¤. `startTransition`ì€ `setState`ë¥¼ closure í˜•íƒœë¡œ 
ë°›ìœ¼ë©° API ì— ë°”ë¡œ ë“±ë¡ë˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ë°˜í™˜ê°’ì€ ì—†ë‹¤.

```jsx
startTransition(() => {
  // âœ… Setting state *during* startTransition call
  setPage('/about');
});
```

ì´ë¯¸ ë Œë”ë§ ëœ ì»´í¬ë„ŒíŠ¸ì˜ ë¶ˆí•„ìš”í•œ fallback ëŒ€ì²´ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ `startTransition`ì„ ì ìš©í•´ë³´ì.

```jsx
export default function App() {
  return (
      <Suspense fallback={<BigSpinner />}>
        <Router />
      </Suspense>
  );
}

function Router() {
  const [page, setPage] = useState('/');

  function navigate(url) {
    startTransition(() => {
      setPage(url);      
    });
  }
  // ...
}
```

ì´ì œ Transitions ê°€ ì‹œì‘ë˜ë©° UI ì—…ë°ì´íŠ¸ê°€ ì§€ì—°ë˜ì–´ `BigSpinner` fallback ì€ ëŒ€ì²´ë˜ì§€ ì•Šê³  í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ `ArtistPage`ì— 
ìˆëŠ” `Albums`ë¥¼ ê°ì‹¸ê³  ìˆëŠ” Suspense ì˜ `AlbumsGlimmer` fallback ë§Œ ëŒ€ì²´ëœë‹¤. ì´ë•Œ ì£¼ì˜í•´ì•¼ í•  ê²ƒì´ `Layout`ì´ fallback 
ìœ¼ë¡œ ëŒ€ì²´ë˜ì§€ ì•Šì•˜ë‹¤ê³  ì•„ì˜ˆ <span style="color: red;">ë Œë” í•¨ìˆ˜ í˜¸ì¶œ ìì²´ê°€ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤!</span>

ë Œë” í•¨ìˆ˜ì˜ í˜¸ì¶œì€ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ì§€ì§€ë§Œ fallback ìœ¼ë¡œ ëŒ€ì²´ë˜ëŠ” ëŒ€ì‹  UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œí‚¤ëŠ” ê²ƒ ë¿ì´ë‹¤. ê·¸ë¦¬ê³  ì´ê²ƒì€ ì´ë¯¸ ê·¸ë ¤ì§„ 
UI ì¼ ë•Œë§Œ ì§€ì—°ë˜ê¸° ë•Œë¬¸ì— ì•„ì§ UI ê°€ ê·¸ë ¤ì§€ì§€ ì•Šì•„ í•´ë‹¹ Suspense ê°€ ìµœì´ˆë¡œ ì‘ë™í•˜ëŠ” ì‹œì ì—ëŠ” fallback ìœ¼ë¡œ ëŒ€ì²´ê°€ ëœë‹¤. ì¦‰, í•´ë‹¹ 
í˜ì´ì§€ ì²« ë°©ë¬¸ ì‹œì—ëŠ” Layout ì˜ fallback ê³¼ ìì‹ ì»´í¬ë„ŒíŠ¸ì˜ fallback ì´ ëª¨ë‘ ì‘ë™í•˜ì§€ë§Œ, ì´í›„ì—ëŠ” ìì‹ì˜ fallback ë§Œ ì‘ë™í•˜ëŠ” ê²ƒì´ë‹¤.

> ë¦¬ì•¡íŠ¸ë¡œ ì•±ì„ ë§Œë“¤ ë•Œ í˜ì´ì§€ ì´ë™ ì‹œ Transitions ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë˜ëŠ” ë° ë‘ ê°€ì§€ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
> 
> - ë Œë”ë§ì´ ì™„ë£Œë˜ê¸° ì „ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ê²ƒì„ í´ë¦­í•˜ë©´ <span style="color: red;">Transition ì„ ì¤‘ë‹¨í•  ìˆ˜ ìˆë‹¤</span> 
>   (ë§Œì•½ Transition ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì‚¬ìš©ìì˜ í´ë¦­ ì…ë ¥ì€ ì „ë‹¬ë˜ì§€ë§Œ ì´ì „ì— í´ë¦­í•œ UI ì—…ë°ì´íŠ¸ ì§€ì—°ì´ ì¤‘ë‹¨ë˜ì§€ ì•Šì•„ 
>    ê¸°ë‹¤ë¦° í›„ ìˆœì°¨ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ëœë‹¤).
> - Transition ì€ ì›ì¹˜ ì•ŠëŠ” loading indicator ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•Šê²Œ í•  ìˆ˜ ìˆë‹¤.
> 
> ë¼ìš°í„°ì— Suspense ì™€ Transitions ë¥¼ ì ìš©í•˜ëŠ” ê²ƒì„ [Building a Suspense-enabled router] ë¼ í•œë‹¤.

<br>

<span style="color: red;">**startTransition**</span> ì‚¬ìš©ì‹œ <span style="color: red;">ìœ ì˜ì </span> ë‘ ê°€ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

__1 ) [startTransition is synchronous][React doesnâ€™t treat my state update as a Transition]__

ì´ë•Œ ì£¼ì˜í•´ì•¼ í•  ê²ƒì´ `startTransition`ì€ ë°˜ë“œì‹œ <span style="color: red;">Synchronous</span> ì—¬ì•¼ í•œë‹¤. ë”°ë¼ì„œ ë‹¤ìŒì€
í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.

```jsx
startTransition(() => {
  // âŒ Setting state *after* startTransition call
  setTimeout(() => {
    setPage('/about');
  }, 1000);
});
```

ë§Œì•½, setTimeout ì„ ì ìš©í•´ì•¼ í•œë‹¤ë©´ ìˆœì„œë¥¼ ë°”ê¿” `startTransition`ì€ ë°˜ë“œì‹œ Synchronous í•˜ë„ë¡ í•´ì•¼ í•œë‹¤.

```jsx
setTimeout(() => {
  startTransition(() => {
    // âœ… Setting state *during* startTransition call
    setPage('/about');
  });
}, 1000);
```

ë§ˆì°¬ê°€ì§€ë¡œ `async/await` ì—­ì‹œ Asynchronous ì½”ë“œì´ê¸° ë•Œë¬¸ì— í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.

```jsx
startTransition(async () => {
  await someAsyncFunction();
  // âŒ Setting state *after* startTransition call
  setPage('/about');
});
```

ì´ë ‡ê²Œ `startTransition` ë°–ìœ¼ë¡œ ë¹¼ë‚´ ë°˜ë“œì‹œ <span style="color: red;">Synchronous</span> ì—¬ì•¼ í•œë‹¤.

```jsx
await someAsyncFunction();
startTransition(() => {
  // âœ… Setting state *during* startTransition call
  setPage('/about');
});
```

<br>

ê·¸ë¦¬ê³  `startTransition`ì„ ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•´ì•¼ í•  ê²ƒì´ ì´ê²ƒì€ ë¸Œë¼ìš°ì € API ì¸ `setTimeout`ê³¼ ë‹¬ë¦¬ ë‚˜ì¤‘ì— ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤.
UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œí‚¤ê¸° ë•Œë¬¸ì— í˜¼ë™í•  ìˆ˜ ìˆì§€ë§Œ <span style="color: red;">startTransition ì—­ì‹œ ë™ê¸°ë¡œ ì‘ë™</span>í•œë‹¤.
ë§ˆì¹˜ context ì „ì²´ë¥¼ async ë¡œ ê°ì‹¸ê³  await ì„ ì‚¬ìš©í•œ ê²ƒê³¼ ìœ ì‚¬í•˜ë‹¤.

```jsx
console.log(1);
startTransition(() => {
  console.log(2);
  setPage('/about');
});
console.log(3);
```

```console
1
2
3
```

ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— 1, 3, 2 ìˆœì„œê°€ ì•„ë‹Œ 1, 2, 3 ìˆœì„œë¡œ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤. ë‹¨ì§€ UI ì—…ë°ì´íŠ¸ ì§€ì—°ì´ ëë‚œ ì´í›„ì— ë‹¤ìŒ ì½”ë“œê°€
ì‹¤í–‰ë˜ë„ë¡ ì ì‹œ ì§€ì—°ë  ë¿ì´ë‹¤.

<br>

__2 ) [Updating an input in a Transition doesn't work]__

ë˜ ë‹¤ë¥¸ ì£¼ì˜ì ì€ <span style="color: red;">**input** ì€ ë™ê¸°ì ìœ¼ë¡œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸</span> ë˜ê¸° ë•Œë¬¸ì— `startTransition`ê³¼
í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. <span style="color: red;">Transitions ê°€ **non-blocking**</span> ì´ê¸° ë•Œë¬¸ì´ë‹¤.

```jsx
const [text, setText] = useState('');
// ...
function handleChange(e) {
  // âŒ Can't use Transitions for controlled input state
  startTransition(() => {
    setText(e.target.value);
  });
}
// ...
return <input value={text} onChange={handleChange} />;
```

ì´ëŸ° ìƒí™©ì—ì„œ í•´ê²° ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆë‹¤.

- ì´ ê²½ìš° ë‘ ê°œì˜ `state`ë¥¼ ë§Œë“¤ì–´ í•˜ë‚˜ëŠ” ê°’ì„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ í•˜ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” Transitions UI ë Œë”ë§ ë¡œì§ì— ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤.
- í•˜ë‚˜ì˜ `state`ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  [useDeferredValue](#h-3-usedeferredvalue) ë¥¼ ì¶”ê°€í•´ ì‹¤ì œ ê°’ì„ ê°ì¶˜ë‹¤.

#### 5. useTransition

`startTransition` API ë¥¼ ì‚¬ìš©í•˜ë©´ `Suspense`ì˜ fallback ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ ì•„ì‰¬ì›€ì´ ìˆëŠ”ë° ë¡œë”© ì¤‘ì´ë¼ëŠ” ì‹œê°ì  
indicator ê°€ ì—†ë‹¤ ë³´ë‹ˆ UI ì—…ë°ì´íŠ¸ ì§€ì—°ìœ¼ë¡œ ì¸í•´ ì•±ì˜ ë°˜ì‘ì´ ëŠë¦¬ê±°ë‚˜ í´ë¦­ì— ë°˜ì‘ì´ ì—†ëŠ” ê²ƒìœ¼ë¡œ ì˜¤í•´í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

ì´ì— ëŒ€í•œ ëŒ€ì•ˆìœ¼ë¡œ ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ `useTransition` <span style="color: red;">Hooks</span> ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. 
`startTransition`ì€ React API ì˜€ìœ¼ë‚˜ `useTransition` ì€ Hooks ë¼ëŠ” ê²ƒì— ìœ ì˜í•˜ì. `useTransition`ì€ `startTransition`ì„ 
ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì— ì§ì ‘ import í•  í•„ìš”ê°€ ì—†ìœ¼ë©° ì‚¬ìš© ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. 

```jsx
const [isPending, startTransition] = useTransition()
```

```jsx
function Router() {
  const [page, setPage] = useState('/');
  const [isPending, startTransition] = useTransition();

  function navigate(url) {
    startTransition(() => {
      setPage(url);
    });
  }
  // ...
  return (
    <Layout isPending={isPending}>
      {content}
    </Layout>
  );
}
```

```jsx
export default function Layout({ children, isPending }) {
  return (
    <div className="layout">
      <section className="header" style={{
        opacity: isPending ? 0.7 : 1
      }}>
        Music Browser
      </section>
      <main>
        {children}
      </main>
    </div>
  );
}
```

ì´ì œ Layout ì˜ í—¤ë”ë¥¼ í†µí•´ Loading indicator ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. ì°¸ê³ ë¡œ ì—¬ê¸°ì„œ `isPending`ì´ `true`ì¸ ê¸°ê°„ì€ Layout 
ì»´í¬ë„ŒíŠ¸ê°€ ì†í•œ Suspense ì˜ fallback ì´ í‘œì‹œë˜ì–´ì•¼ í•˜ëŠ” ê¸°ê°„ ë™ì•ˆì— í•´ë‹¹í•œë‹¤. ì¦‰, `BigSpinner`ë¡œ ëŒ€ì²´ë˜ëŠ” ëŒ€ì‹  `isPending`
indicator ë¥¼ ì‚¬ìš©í•´ ë¡œë”©ì¤‘ì„ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•´ì£¼ëŠ” ê²ƒì´ë‹¤. `isPending`ì€ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— ìˆëŠ” Suspense ì˜ `AlbumsGlimmer` 
fallback ê³¼ëŠ” ë¬´ê´€í•˜ë‹¤.

<br>

<span style="color: red;">**useTransition**</span> ì‚¬ìš©ì‹œ <span style="color: red;">ìœ ì˜ì </span> ë‘ ê°€ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

__1 ) The `useTransition` should be called inside a component__

`useTransition`ì€ Hooks ì´ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œë§Œ í˜¸ì¶œë˜ì–´ì•¼í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ data library ì™€ ê°™ì´ ì»´í¬ë„ŒíŠ¸ ë°–ì—ì„œ 
í˜¸ì¶œì´ í•„ìš”í•˜ë‹¤ë©´ Hooks ëŒ€ì‹  API ì¸ `startTransition`ì„ ì‚¬ìš©í•´ì•¼í•˜ë©°, ì´ ê²½ìš° `isPending` indicator ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

<br>

__2 ) Suspense integrated router should wrap its updates into `startTransition` automatically__

ë¼ìš°í„°ê°€ Suspense ì™€ í†µí•©ëœ ê²½ìš° ë¼ìš°í„° ì—…ë°ì´íŠ¸ë¥¼ `startTransition`ìœ¼ë¡œ wrapping í•´ì•¼ í•œë‹¤.

#### 6. key props

`Suspense`ì™€ `Transitions`ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ë¯¸ ë Œë”ë§ ëœ ì»´í¬ë„ŒíŠ¸ì˜ UI ì—…ë°ì´íŠ¸ë¥¼ ì§€ì—°ì‹œì¼œ fallback ëŒ€ì²´ê°€ ì‘ë™í•˜ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆë‹¤. 
í•˜ì§€ë§Œ ë•Œë¡œëŠ” ê°™ì€ UI ë¼ í•˜ë”ë¼ë„ ë‹¤ì‹œ ë Œë”ë§ ë˜ëŠ” ê²ƒì´ ë” ì¢‹ì€ UI ê°€ ë  ë•Œê°€ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì–´ë–¤ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë³´ëŠ” `ProfilePage` 
ì»´í¬ë„ŒíŠ¸ê°€ ìˆë‹¤ê³  í•´ë³´ì. ë™ì¼ ì‚¬ìš©ìì˜ ì—¬ëŸ¬ ì •ë³´ë¥¼ ë³´ëŠ” ë™ì•ˆ ì´ ì‚¬ìš©ìì˜ ê³µí†µì ì¸ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì˜ content ëŠ” fallback ì´ 
ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤. ì„¸ë¶€ ì •ë³´ì˜ ì—…ë°ì´íŠ¸ë§Œ fallback ì´ ë°œìƒí•˜ëŠ” ê²ƒì´ ì¢‹ì€ UI ë‹¤.

í•˜ì§€ë§Œ ë‹¤ë¥¸ ì‚¬ìš©ìë¡œ ë³€ê²½ë  ê²½ìš°ëŠ” ì–´ë–¨ê¹Œ? ë™ì¼í•œ UI ì´ê¸° ë•Œë¬¸ì— ì˜¤íˆë ¤ fallback ì´ ì—†ì„ ê²½ìš° ë³€í™”ê°€ í¬ì§€ ì•Šë‹¤ë©´ UI ì—…ë°ì´íŠ¸ë¥¼ ì¸ì§€í•˜ì§€ 
ëª» í•  ê°€ëŠ¥ì„±ì´ ìˆë‹¤. ì´ëŸ° ê²½ìš° ì˜ë„ì ìœ¼ë¡œ fallback ëŒ€ì²´ë¥¼ ì‘ë™ì‹œì¼œ UI ì—…ë°ì´íŠ¸ê°€ ì´ë£¨ì–´ì¡ŒìŒì„ í‘œí˜„í•´ì£¼ëŠ” ê²ƒì´ í™•ì‹¤íˆ UI ì—…ë°ì´íŠ¸ë¥¼ ì¸ì§€ì‹œì¼œ 
ë” ì¢‹ì€ ì‚¬ìš©ì ê²½í—˜ì„ ê°–ê²Œ í•œë‹¤.

ì–´ë–»ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆì„ê¹Œ? ì»´í¬ë„ŒíŠ¸ì˜ iterating ì‹œ `key` props ë¥¼ ì‚¬ìš©í•´ ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ê³ ìœ ê°’ì„ ì œê³µí•œë‹¤. ì´ ê²½ìš°ë„ ë™ì¼í•˜ê²Œ 
`key` props ë¥¼ ì‚¬ìš©í•˜ë©´ Suspense ëŠ” Transition ì„ ì‚¬ìš©í•˜ë”ë¼ë„ `key`ê°€ ë³€ê²½ë˜ë©´ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ë¡œ ì¸ì‹í•´ fallback ëŒ€ì²´ë¥¼ ìˆ˜í–‰í•œë‹¤.

```jsx
<ProfilePage key={queryParams.id} />
```

ì´ë ‡ê²Œ `key` props ë§Œ ì œê³µí•˜ë©´ ë³€ê²½ ì—¬ë¶€ë¥¼ ë¦¬ì•¡íŠ¸ê°€ í™•ì¸ í›„ fallback ëŒ€ì²´ ì—¬ë¶€ë¥¼ íŒë‹¨í•œë‹¤.

#### 7. Error Boundary

`useTransition`ì„ ìœ„í•œ Error Boundary ëŠ” ë¦¬ì•¡íŠ¸ 19 ì— ì¶”ê°€ë  ì˜ˆì •ìœ¼ë¡œ í˜„ì¬ëŠ” canary ë²„ì „ì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

```shell
npm i react-error-boundary
```

ê³µì‹ ë¬¸ì €ì—ì„œë„ í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ë¡œ ì§ì ‘ êµ¬í˜„í•˜ê¸°ë³´ë‹¤ëŠ” [bvaughn / react-error-boundary](https://github.com/bvaughn/react-error-boundary#readme) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í–ˆê¸°ì— ì—¬ê¸°ì„œë„ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ê³ ì í•œë‹¤. 
í˜¹ì‹œ [ErrorBoundary cannot be used as a JSX component](https://github.com/bvaughn/react-error-boundary?tab=readme-ov-file#errorboundary-cannot-be-used-as-a-jsx-component)
ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë§í¬ë¥¼ ì°¸ì¡°í•´ í•´ê²°í•˜ë„ë¡ í•œë‹¤.

```jsx
export function AddCommentContainer() {
  return (
    <ErrorBoundary fallback={<p>âš ï¸Something went wrong</p>}>
      <AddCommentButton />
    </ErrorBoundary>
  );
}

function addComment(comment) {
  if (comment == null) {
    throw new Error("Example Error: An error thrown to trigger error boundary");
  }
}

function AddCommentButton() {
  const [pending, startTransition] = useTransition();

  return (
    <button
      disabled={pending}
      onClick={() => {
        startTransition(() => {
          addComment();
        });
      }}
    >
      Add comment
    </button>
  );
}
```

---

### 3. Suspense with axios on React 18 ğŸ‘©â€ğŸ’»

`use`ëŠ” í˜„ì¬ canary ì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ ê¸°ëŠ¥ì„ ì•„ì˜ˆ ëª» ì“°ëŠ” ê±´ ì•„ë‹ˆê³  React ê°€ ê³µì‹ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ Promise ë¿ ì•„ë‹ˆë¼ 
Context ì—ë„ ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜ì¼ ë¿ í˜„ì¬ë„ Suspense ì— Promise ë¥¼ ì»¨íŠ¸ë¡¤ í•˜ê¸° ìœ„í•´ Wrapping í•¨ìˆ˜ `use`ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
ê³µì‹ ë¬¸ì„œì—ì„œ ìƒ˜í”Œë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¥¼ ë„ê³  ìˆë‹¤.

```javascript
export function use(promise) {
  if (promise.status === "fulfilled") {
    return promise.value;
  } else if (promise.status === "rejected") {
    throw promise.reason;
  } else if (promise.status === "pending") {
    throw promise;
  } else {
    promise.status = "pending";
    promise.then(
      (result) => {
        promise.status = "fulfilled";
        promise.value = result;
      },
      (reason) => {
        promise.status = "rejected";
        promise.reason = reason;
      },
    );
    throw promise;
  }
}
```

TypeScript í™˜ê²½ì´ë©° Axios ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ Wrapping í•¨ìˆ˜ `use`ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```typescript
import { AxiosPromise } from "axios";

export const use = <T>(promise: AxiosPromise<T>) => {
  let status = "pending";
  let result: T;

  const suspender = promise
    .then((response) => {
      status = "success";
      result = response.data;
    })
    .catch((response) => {
      status = "error";
      result = response.error;
    });

  return () => {
    switch (status) {
      case "pending":
        throw suspender;
      case "success":
        return result;
      case "error":
        return result as any;
      default:
        throw new Error("Unknown status");
    }
  };
};
```

```tsx
<Suspense fallback={<Loading />}>
  <Purchased />
  <button onClick={() => navigate("/")}>ì²« í˜ì´ì§€ë¡œ</button>
</Suspense>
```

```tsx
const Purchased: React.FC = () => {
  const [orderHistory, setOrderHistory] = useState<OrderInfo[]>();
  const { totals } = useContext(OrderContext);

  const getData = async () => {
    const promise = axios.post("/order", { price: totals.total });
    setOrderHistory(use(promise));
  };

  useEffect(() => {
    getData();
  }, []);

  return (
    <PurchasedWrapper>
      <h2>ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>
      <h3>ì£¼ë¬¸ ë‚´ì—­</h3>
      <div className="order-history">
        <h5>ì£¼ë¬¸ ë²ˆí˜¸</h5>
        <h5>ì£¼ë¬¸ ê¸ˆì•¡</h5>
        {orderHistory?.map((orderInfo) => (
          <Fragment key={orderInfo.orderNumber}>
            <div>{orderInfo.orderNumber}</div>
            <div>{orderInfo.price}</div>
          </Fragment>
        ))}
      </div>
    </PurchasedWrapper>
  );
};
```



<br><br>

---
Reference

1. "Suspense." React.dev Docs. accessed Jun. 03, 2024, [https://react.dev/reference/react/Suspense][React - Suspense].
2. "useTransition." React.dev Docs. accessed Jun. 03, 2024, [https://react.dev/reference/react/useTransition][useTransition].


[React - Suspense]:https://react.dev/reference/react/Suspense
[useDeferredValue]:https://react.dev/reference/react/useDeferredValue
[startTransition]:https://react.dev/reference/react/startTransition
[useTransition]:https://react.dev/reference/react/useTransition
[React doesnâ€™t treat my state update as a Transition]:https://react.dev/reference/react/useTransition#react-doesnt-treat-my-state-update-as-a-transition
[Updating an input in a Transition doesn't work]:https://react.dev/reference/react/useTransition#updating-an-input-in-a-transition-doesnt-work
[Building a Suspense-enabled router]:https://react.dev/reference/react/useTransition#building-a-suspense-enabled-router
